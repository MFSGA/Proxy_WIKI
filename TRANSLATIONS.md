# ã€ŠComprehensive Rustã€‹ç¿»è¯‘æŒ‡å— ğŸ¦€

æˆ‘ä»¬éå¸¸æœŸå¾…ä½ èƒ½å¸®åŠ©æŠŠè¯¾ç¨‹ç¿»è¯‘æˆå…¶ä»–è¯­è¨€ï¼å·²æœ‰çš„ç¿»è¯‘è¯·æŸ¥çœ‹[ç¿»è¯‘é¡µé¢][translations page]ã€‚

[translations page]: https://google.github.io/comprehensive-rust/running-the-course/translations.html

æˆ‘ä»¬ä½¿ç”¨ [Gettext] ç³»ç»Ÿè¿›è¡Œç¿»è¯‘ã€‚è¿™æ„å‘³ç€ä½ æ— éœ€ç›´æ¥ä¿®æ”¹ Markdown æ–‡ä»¶ï¼Œè€Œæ˜¯ä¿®æ”¹ `po/` ç›®å½•ä¸‹çš„ `.po` æ–‡ä»¶ã€‚è¿™äº› `.po` æ–‡ä»¶æ˜¯åŸºäºæ–‡æœ¬çš„å°å‹ç¿»è¯‘æ•°æ®åº“ã€‚

> **æç¤ºï¼š** ä¸è¦æ‰‹åŠ¨ç¼–è¾‘ `.po` æ–‡ä»¶ï¼Œè¯·ä½¿ç”¨ PO ç¼–è¾‘å™¨ï¼Œä¾‹å¦‚ [Poedit](https://poedit.net/)ã€‚ä¹Ÿæœ‰å¤šä¸ªåœ¨çº¿ç¼–è¾‘å™¨å¯ç”¨ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿æ–‡ä»¶ç¼–ç æ­£ç¡®ã€‚

> **é‡è¦ï¼š** ç¼–è¾‘ PO æ–‡ä»¶åéœ€è¦è¿è¡Œ `dprint fmt`ï¼Œä»¥ç¡®ä¿æ–‡ä»¶æ ¼å¼ä¸€è‡´ã€‚ä½ éœ€è¦å®‰è£… Gettext å·¥å…·ï¼Œå…·ä½“è§ä¸‹æ–¹çš„å‡†å¤‡éƒ¨åˆ†ã€‚

æ¯ç§è¯­è¨€éƒ½æœ‰ä¸€ä¸ª `.po` æ–‡ä»¶ï¼Œä»¥ [ISO 639] è¯­è¨€ä»£ç å‘½åï¼šä¸¹éº¦è¯­ä½¿ç”¨ `po/da.po`ï¼ŒéŸ©è¯­ä½¿ç”¨ `po/ko.po`ï¼Œä»¥æ­¤ç±»æ¨ã€‚`.po` æ–‡ä»¶åŒ…å«æ‰€æœ‰è‹±æ–‡æ–‡æœ¬ä»¥åŠå¯¹åº”çš„ç¿»è¯‘ã€‚å®ƒä»¬ç”±åªåŒ…å«è‹±æ–‡æ–‡æœ¬çš„ `messages.pot` æ¨¡æ¿æ–‡ä»¶åˆå§‹åŒ–ã€‚

ä¸‹é¢å°†å±•ç¤ºå¦‚ä½•ä½¿ç”¨ GNU Gettext å·¥å…·æ›´æ–°å’Œå¤„ç† `.po` ä¸ `.pot` æ–‡ä»¶ã€‚

[Gettext]: https://www.gnu.org/software/gettext/manual/html_node/index.html
[ISO 639]: https://en.wikipedia.org/wiki/List_of_ISO_639-1_codes

## å‡†å¤‡å·¥ä½œ

è¯·ç¡®ä¿ä½ èƒ½[æ„å»ºè¯¾ç¨‹](README.md#building)ã€‚ä½ è¿˜éœ€è¦å®‰è£… Gettext å·¥å…·ä¸­çš„ `msgmerge` å’Œ `msgcat`ã€‚è¯¦æƒ…è¯·è§æˆ‘ä»¬çš„[è´¡çŒ®æŒ‡å—](CONTRIBUTING.md#formatting)ã€‚

## åˆ›å»ºå’Œæ›´æ–°ç¿»è¯‘

é¦–å…ˆï¼Œä½ éœ€è¦äº†è§£å¦‚ä½•æ›´æ–° `.pot` å’Œ `.po` æ–‡ä»¶ã€‚

åˆ‡å‹¿ä¿®æ”¹è‡ªåŠ¨ç”Ÿæˆçš„ `book/xgettext/messages.pot` æ–‡ä»¶ï¼Œä¹Ÿä¸è¦ç¼–è¾‘ `po/xx.po` æ–‡ä»¶ä¸­çš„ `msgid` æ¡ç›®ã€‚å¦‚æœå‘ç°é”™è¯¯ï¼Œéœ€è¦å…ˆä¿®æ­£åŸå§‹è‹±æ–‡æ–‡æœ¬ã€‚ä¿®æ­£åçš„è‹±æ–‡ä¼šåœ¨ç¿»è¯‘è€…ä¸‹æ¬¡æ›´æ–° `.po` æ–‡ä»¶æ—¶æµå…¥å…¶ä¸­ã€‚

> **æç¤ºï¼š** ç¼–å†™ç¿»è¯‘æ—¶è¯·å‚é˜…æˆ‘ä»¬çš„[é£æ ¼æŒ‡å—](STYLE.md)ã€‚

### ç”Ÿæˆ PO æ¨¡æ¿

è¦æå–åŸå§‹è‹±æ–‡æ–‡æœ¬å¹¶ç”Ÿæˆ `messages.pot` æ–‡ä»¶ï¼Œå…ˆæ„å»ºä¹¦ç±ï¼Œè¿™ä¼šè‡ªåŠ¨è°ƒç”¨ `mdbook-xgettext` æ¸²æŸ“å™¨ï¼š

```shell
mdbook build
```

ç”Ÿæˆçš„ POT æ–‡ä»¶ä½äº `book/xgettext/messages.pot`ã€‚

### åˆå§‹åŒ–æ–°ç¿»è¯‘

è¦å¼€å§‹ä¸€ä¸ªæ–°ç¿»è¯‘ï¼Œå…ˆç”Ÿæˆ `book/xgettext/messages.pot` æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨ `msginit` ä¸ºå‡è®¾çš„ `xx` è¯­è¨€åˆ›å»º `xx.po`ï¼š

```shell
msginit -i book/xgettext/messages.pot -l xx -o po/xx.po
```

ä½ ä¹Ÿå¯ä»¥ç›´æ¥å°† `book/xgettext/messages.pot` å¤åˆ¶åˆ° `po/xx.po`ï¼Œç„¶åæŠŠæ–‡ä»¶å¤´ï¼ˆ`msgid ""` çš„ç¬¬ä¸€æ¡è®°å½•ï¼‰æ›´æ–°ä¸ºæ­£ç¡®çš„è¯­è¨€ã€‚

> **æç¤ºï¼š** å¯ä»¥ä½¿ç”¨ [`cloud-translate`](https://github.com/mgeisler/cloud-translate) å·¥å…·å¿«é€Ÿæœºå™¨ç¿»è¯‘ã€‚é€šè¿‡ä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼š
>
> ```shell
> cargo install cloud-translate
> ```
>
> æœªç¿»è¯‘çš„æ¡ç›®ä¼šå‘é€åˆ° GCP Cloud Translateã€‚éƒ¨åˆ†ç¿»è¯‘ä¼šæœ‰è¯¯ï¼Œä¹‹åå¿…é¡»äººå·¥æ£€æŸ¥ã€‚

æ¥ä¸‹æ¥ï¼Œè¯·æ›´æ–° `.github/labeler.yml` ä»¥åŠ å…¥æ–°è¯­è¨€ï¼š

```diff
+"translation/xx":
  - changed-files:
      - any-glob-to-any-file: po/xx.po
```

### åˆ·æ–°ç°æœ‰ç¿»è¯‘

éšç€è‹±æ–‡å†…å®¹æ›´æ–°ï¼Œç¿»è¯‘ä¼šé€æ¸è¿‡æ—¶ã€‚ç¿»è¯‘ä¸­åŒ…å«ä¸€ä¸ª POT-Creation-Date å¤´ï¼Œæ ‡è®°ä¸Šæ¬¡åŒæ­¥è‹±æ–‡æ¶ˆæ¯çš„æ—¶é—´ã€‚

è¦ç”¨æœ€æ–°æ¶ˆæ¯æ›´æ–° `po/xx.po`ï¼Œå…ˆæå–è‹±æ–‡æ–‡æœ¬ç”Ÿæˆ `book/xgettext/messages.pot` æ¨¡æ¿ï¼Œç„¶åè¿è¡Œï¼š

```shell
msgmerge --update po/xx.po book/xgettext/messages.pot
```

æ³¨æ„ POT-Creation-Date å­—æ®µä¼šæ›´æ–°ä¸ºå½“å‰æ—¶é—´ã€‚è¿™å°†æˆä¸ºç¿»è¯‘çš„æ–°åŸºå‡†ï¼šä¹‹åæ–°å¢çš„è‹±æ–‡ä¸ä¼šå‡ºç°åœ¨ä½ çš„ç¿»è¯‘ä¸­ï¼ŒåŒ…æ‹¬å…¨æ–°çš„é¡µé¢ã€‚

è¿è¡Œ `msgmerge` æ—¶ï¼Œæœªå˜çš„æ¡ç›®ä¿æŒä¸å˜ï¼Œè¢«åˆ é™¤çš„æ¡ç›®ä¼šæ ‡è®°ä¸ºæ—§æ¡ç›®ï¼Œæ›´æ–°çš„æ¡ç›®ä¼šæ ‡è®°ä¸º â€œfuzzyâ€ã€‚æ ‡è®°ä¸º fuzzy çš„æ¡ç›®åœ¨å‘å¸ƒæ—¶ä¸ä¼šè¢«ä½¿ç”¨ï¼ä½ å¿…é¡»æ‰‹å·¥æ£€æŸ¥è¿™äº›æ¡ç›®ï¼Œç¡®è®¤ç¿»è¯‘æ— è¯¯å¹¶å»æ‰ fuzzy æ ‡è®°ã€‚

> **æ³¨æ„ï¼š** ä½ çš„ PR åº”è¯¥è¦ä¹ˆæ˜¯è¿è¡Œ `msgmerge` çš„ç»“æœï¼Œè¦ä¹ˆæ˜¯å¯¹è¯¥è¯­è¨€ PO æ–‡ä»¶çš„æ–°ç¿»è¯‘å·¥ä½œã€‚é¿å…æ··åˆä¸¤è€…ï¼Œå› ä¸ºè¿™æ ·é€šå¸¸ä¼šäº§ç”Ÿéå¸¸å¤§çš„ diffï¼Œéš¾ä»¥å®¡æ ¸ã€‚

### ç¼–è¾‘ç¿»è¯‘

è¯·å®‰è£… PO ç¼–è¾‘å™¨æ¥ç¼–è¾‘ä½ æ‰€ç”¨è¯­è¨€çš„ `.po` æ–‡ä»¶ã€‚è¿™äº›æ–‡ä»¶æ˜¯ç®€å•çš„æ–‡æœ¬æ–‡ä»¶ï¼Œä½†ä¸“ç”¨ç¼–è¾‘å™¨ä¼šå¸®ä½ æ­£ç¡®è½¬ä¹‰è¯¸å¦‚ `"` ä¹‹ç±»çš„å­—ç¬¦ã€‚

PO ç¼–è¾‘å™¨æœ‰å¾ˆå¤šã€‚[Poedit](https://poedit.net/) æ˜¯ä¸€ä¸ªè·¨å¹³å°çš„æµè¡Œé€‰æ‹©ï¼Œä½ ä¹Ÿèƒ½æ‰¾åˆ°å¤šä¸ªåœ¨çº¿ç¼–è¾‘å™¨ã€‚

### æ ¼å¼åŒ–ç¿»è¯‘

å¦‚æœæ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®ï¼ŒPR ä¼šæŠ¥é”™ã€‚è¯·æŒ‰[å‡†å¤‡å·¥ä½œ](#å‡†å¤‡å·¥ä½œ)å®‰è£… [Gettext] å’Œ [`dprint`](https://dprint.dev/)ï¼Œç„¶åè¿è¡Œï¼š

```shell
dprint fmt po/xx.po
```

è¿™ä¼šè‡ªåŠ¨ä¸ºä½ æ ¼å¼åŒ– `.po` æ–‡ä»¶ã€‚æäº¤æ ¼å¼ä¿®å¤å¹¶æ¨é€åˆ†æ”¯ï¼ŒPR åº”è¯¥å°±ä¸ä¼šå†æœ‰æ ¼å¼é—®é¢˜ã€‚

## ä½¿ç”¨ç¿»è¯‘

æœ¬èŠ‚è¯´æ˜å¦‚ä½•ä½¿ç”¨ç¿»è¯‘ç”Ÿæˆæœ¬åœ°åŒ– HTML è¾“å‡ºã€‚

> **æ³¨æ„ï¼š** å¯¹äºæ‰€æœ‰æ ‡è®°ä¸º â€œfuzzyâ€ï¼ˆåœ¨ Poedit ä¸­æ˜¾ç¤ºä¸º â€œNeeds workâ€ï¼‰çš„æ¡ç›®ï¼Œ`mdbook` ä¼šä½¿ç”¨åŸå§‹çš„æœªç¿»è¯‘å†…å®¹ã€‚è¿™åœ¨ä½¿ç”¨ [`cloud-translate`](https://github.com/mgeisler/cloud-translate) åˆå§‹åŒ–ç¿»è¯‘æ—¶å°¤å…¶é‡è¦ï¼Œå› ä¸ºæ‰€æœ‰æ¡ç›®éƒ½ä¼šè¢«æ ‡è®°ä¸º fuzzyã€‚

### æ„å»ºç¿»è¯‘

ç¡®ä¿è‡³å°‘æ‰§è¡Œè¿‡ä¸€æ¬¡[æ„å»ºè®¾ç½®](./README.md#building)ã€‚

è¦åœ¨è¾“å‡ºä¸­ä½¿ç”¨ `po/xx.po`ï¼Œè¿è¡Œï¼š

```shell
MDBOOK_BOOK__LANGUAGE=xx mdbook build -d book/xx
```

è¿™ä¼šå‘Šè¯‰ `mdbook-gettext` é¢„å¤„ç†å™¨ä½¿ç”¨ `po/xx.po` ç¿»è¯‘ä¹¦ç±ã€‚HTML è¾“å‡ºå¯åœ¨ `book/xx/html/` æ‰¾åˆ°ã€‚

### é¢„è§ˆç¿»è¯‘

ä¸å¹³æ—¶ä¸€æ ·ï¼Œå¯ä»¥ç”¨ `mdbook serve` è¾¹ç¿»è¯‘è¾¹æŸ¥çœ‹ï¼Œå‘½ä»¤ä¸ä¸Šé¢çš„ `mdbook build` ç›¸åŒï¼š

```shell
MDBOOK_BOOK__LANGUAGE=xx mdbook serve -d book/xx
```

å½“ä½ æ›´æ–° `po/xx.po` æ–‡ä»¶æ—¶ï¼Œè¯‘æ–‡ä¼šè‡ªåŠ¨é‡æ–°åŠ è½½ã€‚

## å®¡é˜…ç¿»è¯‘

å¯åŠ¨æ–°ç¿»è¯‘æ—¶ï¼Œæˆ‘ä»¬ä¼šå¯»æ‰¾å¯ä»¥å¸®åŠ©å®¡é˜…çš„åŒå­¦ã€‚å®¡é˜…è€…é€šå¸¸æ˜¯ Googlerï¼Œä½†ä¸é™äºæ­¤ã€‚è‹¥å¸Œæœ›åœ¨ä½ çš„è¯­è¨€æœ‰æ–° PR æ—¶è‡ªåŠ¨æ”¶åˆ°é‚®ä»¶ï¼Œè¯·å°†è‡ªå·±æ·»åŠ åˆ° [CODEOWNERS] æ–‡ä»¶ã€‚

å®¡é˜…ç¿»è¯‘æ—¶ï¼Œè¯·è®°ä½ç¿»è¯‘æ˜¯ä¸€é¡¹çˆ±çš„åŠ³åŠ¨ã€‚æœ‰äººèŠ±è´¹ç©ºé—²æ—¶é—´ç¿»è¯‘è¯¾ç¨‹ï¼Œåªä¸ºè®©æ›´å¤šäººèƒ½ç”¨è‡ªå·±çš„è¯­è¨€å­¦ä¹  Rustã€‚

æ–°çš„è¿›è¡Œä¸­è¯­è¨€åœ¨ PR åˆå¹¶åä¸ä¼šç«‹å³å‘å¸ƒã€‚å› æ­¤ï¼Œåªè¦ç¿»è¯‘å¤§è‡´åˆç†å°±å¯ä»¥æ”¾å¿ƒåˆå¹¶ã€‚ç›¸æ¯”ç•™ä¸‹ 50+ æ¡è¯„è®ºï¼Œè®©è´¡çŒ®è€…åœ¨åç»­ PR ä¸­æ”¹è¿›å¾€å¾€æ›´å¥½ã€‚

### GitHub å»ºè®®

å®¡é˜…ç¿»è¯‘ PR æ—¶ï¼Œè¯·ä½¿ç”¨
[GitHub æç¤ºåŠŸèƒ½](https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/commenting-on-a-pull-request)ã€‚
æ­¤åŠŸèƒ½å…è®¸ä½ ç›´æ¥å†™å‡ºä½ è®¤ä¸ºæŸè¡Œæˆ–æ®µè½åº”è¯¥æ€æ ·è¡¨è¿°ã€‚ä½¿ç”¨å·¥å…·æ æœ€å·¦ä¾§çš„æŒ‰é’®åˆ›å»ºå»ºè®®ã€‚

PR ä½œè€…å¯ä»¥
[ä¸€é”®åº”ç”¨ä¿®æ”¹](https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/incorporating-feedback-in-your-pull-request)ï¼Œ
å¤§å¹…å‡å°‘å®¡é˜…å¾€è¿”ã€‚

### ä¸å®Œæ•´çš„ç¿»è¯‘

å½“è¯¾ç¨‹å‰ 1-2 å¤©å†…å®¹å·²å®Œæˆç¿»è¯‘æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥å‘å¸ƒè¯‘æ–‡å¹¶ä»[ç¿»è¯‘é¡µé¢][translations page]é“¾æ¥è¿‡å»ã€‚è¿™æ ·å¯ä»¥åº†ç¥è¾›å‹¤ä»˜å‡ºï¼Œå³ä¾¿ç¿»è¯‘å°šæœªå®Œå·¥ã€‚

[CODEOWNERS]: https://github.com/google/comprehensive-rust/blob/main/.github/CODEOWNERS

## å‘å¸ƒæµç¨‹

> æœ¬èŠ‚é¢å‘ã€ŠComprehensive Rustã€‹çš„å¼€å‘è€…ï¼Œä½†ä¹Ÿèƒ½å¸®åŠ©ä½ äº†è§£ç¿»è¯‘å‘å¸ƒæµç¨‹ã€‚

å½“ `main` åˆ†æ”¯æœ‰å˜æ›´æ—¶ï¼Œä¼šè§¦å‘ [`publish.yml`] GitHub CI å·¥ä½œæµç¨‹ã€‚

å·¥ä½œæµç¨‹ä¸­çš„ `publish` ä»»åŠ¡ä¼šï¼š

- æŒ‰ [`CONTRIBUTING`](CONTRIBUTING.md) çš„æè¿°å®‰è£…ä¾èµ–ã€‚
- ä½¿ç”¨ [`build.sh`] æ„å»ºè¯¾ç¨‹çš„æ‰€æœ‰ç¿»è¯‘ï¼ŒåŒ…æ‹¬åŸå§‹è‹±æ–‡ã€‚è‹±æ–‡ HTML è¾“å‡ºä½äº `book/html/`ï¼Œ`xx` è¯­è¨€çš„ HTML è¾“å‡ºä½äº `book/xx/html/`ã€‚
- å°†æ•´ä¸ª `book/html/` ç›®å½•å‘å¸ƒåˆ° https://google.github.io/comprehensive-rust/ã€‚

[`build.sh`]: https://github.com/google/comprehensive-rust/blob/main/.github/workflows/build.sh

### `build.sh`

[`build.yml`] ç”¨äºæµ‹è¯• PR ä»£ç ï¼Œ[`publish.yml`] ç”¨äºå‘å¸ƒæˆå“ï¼Œè¿™ä¸¤ä¸ªæµç¨‹éƒ½ä¼šä½¿ç”¨ `build.sh`ã€‚

[`build.yml`]: https://github.com/google/comprehensive-rust/blob/main/.github/workflows/build.yml
[`publish.yml`]: https://github.com/google/comprehensive-rust/blob/main/.github/workflows/publish.yml

è¯¥è„šæœ¬çš„ä»»åŠ¡æ˜¯è°ƒç”¨ `mdbook build`ï¼Œä½†ä¼šå¤šåšä¸€äº›å‡†å¤‡ï¼š

- ä¼šå¯ç”¨ `mdbook-pandoc` ä»¥ç”Ÿæˆ PDF è¾“å‡ºã€‚é»˜è®¤å…³é—­æ­¤åŠŸèƒ½ï¼Œæ–¹ä¾¿å¤§å®¶æ— éœ€é…ç½® LaTeX ä¹Ÿèƒ½è¿è¡Œ `mdbook build`ã€‚

#### è¿˜åŸç¿»è¯‘

æ„å»ºéè‹±æ–‡ç¿»è¯‘æ—¶ï¼Œ`build.sh` ä¼šå°†æ‰€æœ‰ Markdown æ–‡ä»¶è¿˜åŸåˆ° POT-Creation-Date è®°å½•çš„ç‰ˆæœ¬ã€‚

è¿™æ„å‘³ç€ï¼š

- è‹±æ–‡æ–‡æœ¬æ›´æ–°æ—¶ï¼Œç¿»è¯‘ä¸ä¼šé€€åŒ–ã€‚
- ç¿»è¯‘ä¸ä¼šæ”¶åˆ°æœ€æ–°çš„è‹±æ–‡ä¿®æ­£ã€‚

è„šæœ¬é€šè¿‡ä¸€æ¡ç®€å•çš„å‘½ä»¤å®Œæˆè¿˜åŸï¼š

```sh
$ git restore --source $LAST_COMMIT src/ third_party/
```

å…¶ä¸­ `$LAST_COMMIT` æ˜¯ POT-Creation-Date æ‰€åœ¨çš„æäº¤ã€‚

å› æ­¤ï¼Œæ¯ä¸ªç¿»è¯‘éƒ½ä¼šä½¿ç”¨æœ€æ–°çš„ä¸»é¢˜ã€CSSã€JavaScript ç­‰ã€‚

è¿è¡Œå®Œ `build.sh` åï¼Œå·¥ä½œåŒºä¼šå¤„äºæœªæ¸…ç†çŠ¶æ€ã€‚å¦‚æœä½ æƒ³æ¥ç€æ„å»ºè‹±æ–‡ç‰ˆæœ¬ï¼Œéœ€è¦æ‰‹åŠ¨æ¸…ç†ã€‚

## çŠ¶æ€æŠ¥å‘Š

ä¼šè‡ªåŠ¨ç”Ÿæˆä¸¤ä»½ç¿»è¯‘çŠ¶æ€æŠ¥å‘Šï¼š

- [æŒ‰ä»“åº“è®°å½•çš„ç¿»è¯‘çŠ¶æ€][translation-report]
- [ä½¿ç”¨ msgmerge åŒæ­¥åˆ°æœ€æ–°è‹±æ–‡åçš„ç¿»è¯‘çŠ¶æ€][synced-translation-report]

ä½ ä¹Ÿå¯ä»¥åœ¨æœ¬åœ°ç”Ÿæˆæ­¤æŠ¥å‘Šï¼Œä»¥æŸ¥çœ‹æœ¬åœ°æ›´æ”¹çš„æ•ˆæœï¼š

```shell
i18n-report translation-report.html po/*.po
```

[translation-report]: https://google.github.io/comprehensive-rust/translation-report.html
[synced-translation-report]: https://google.github.io/comprehensive-rust/synced-translation-report.html
